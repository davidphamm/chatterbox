{"ast":null,"code":"import _regeneratorRuntime from\"/Users/davidpham/Desktop/chatterbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/davidpham/Desktop/chatterbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/davidpham/Desktop/chatterbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import{useHistory}from'react-router-dom';import{ChatEngine}from'react-chat-engine';import{auth}from'../firebase';import{useAuth}from'../contexts/AuthContext';import axios from'axios';var Chats=function Chats(){var history=useHistory();var _useAuth=useAuth(),user=_useAuth.user;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var handleLogout=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signOut();case 2:history.push('/');case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleLogout(){return _ref.apply(this,arguments);};}();var getFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(url);case 2:response=_context2.sent;_context2.next=5;return response.blob();case 5:data=_context2.sent;return _context2.abrupt(\"return\",new File([data],'userPhoto.jpg',{type:'image/jpeg'}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getFile(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){if(!user){history.push('/');return;}axios.get('https://api.chatengine.io/users/me/',{headers:{'project-id':process.env.REACT_APP_CHAT_ENGINE_ID,'user-name':user.email,'user-secret':user.uid}}).then(function(){setLoading(false);}).catch(function(){var formdata=new FormData();formdata.append('email',user.email);formdata.append('username',user.email);formdata.append('secret',user.uid);getFile(user.photoURL).then(function(avatar){formdata.append('avatar',avatar,avatar.name);axios.post(\"https://api.chatengine.io/users/\",formdata,{headers:{\"private-key\":process.env.REACT_APP_CHAT_ENGINE_KEY}}).then(function(){return setLoading(false);}).catch(function(error){return console.log(error);});});});},[user,history]);if(!user||loading)return'Loading...';return/*#__PURE__*/React.createElement(\"div\",{className:\"chats-page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"logo-tab\"},/*#__PURE__*/React.createElement(\"h1\",null,\"ChatterBox\")),/*#__PURE__*/React.createElement(\"div\",{onClick:handleLogout,className:\"logout-tab\"},\"Logout\")),/*#__PURE__*/React.createElement(\"div\",{className:\"chatEngine\"},/*#__PURE__*/React.createElement(ChatEngine,{height:\"calc(100vh - 66px)\",projectID:process.env.REACT_APP_CHAT_ENGINE_ID,userName:user.email,userSecret:user.uid})));};export default Chats;","map":{"version":3,"names":["React","useRef","useState","useEffect","useHistory","ChatEngine","auth","useAuth","axios","Chats","history","user","loading","setLoading","handleLogout","signOut","push","getFile","url","fetch","response","blob","data","File","type","get","headers","process","env","REACT_APP_CHAT_ENGINE_ID","email","uid","then","catch","formdata","FormData","append","photoURL","avatar","name","post","REACT_APP_CHAT_ENGINE_KEY","error","console","log"],"sources":["/Users/davidpham/Desktop/chatterbox/src/components/Chats.js"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react'\nimport { useHistory } from 'react-router-dom';\nimport { ChatEngine } from 'react-chat-engine';\nimport { auth } from '../firebase';\nimport { useAuth } from '../contexts/AuthContext';\nimport axios from 'axios';\n\nconst Chats = () => {\n    const history = useHistory();\n    const { user } = useAuth();\n    const [loading, setLoading] = useState(false);\n\n    const handleLogout = async () => {\n        await auth.signOut();\n\n        history.push('/');\n    }\n\n    const getFile = async (url) => {\n        const response = await fetch(url);\n        const data = await response.blob();\n\n        return new File([data], 'userPhoto.jpg', { type: 'image/jpeg' });\n    }\n\n    useEffect(() => {\n        if(!user) {\n            history.push('/');\n\n            return;\n        }\n\n        axios.get('https://api.chatengine.io/users/me/', {\n            headers: {\n                'project-id': process.env.REACT_APP_CHAT_ENGINE_ID,\n                'user-name': user.email,\n                'user-secret': user.uid,\n            }\n        })\n        .then(() => {\n            setLoading(false);\n        })\n        .catch(() => {\n            let formdata = new FormData();\n            formdata.append('email', user.email);\n            formdata.append('username', user.email);\n            formdata.append('secret', user.uid);\n\n            getFile(user.photoURL)\n                .then((avatar) => {\n                    formdata.append('avatar', avatar, avatar.name)\n\n                    axios.post(\"https://api.chatengine.io/users/\",\n                        formdata,\n                        { headers: { \"private-key\": process.env.REACT_APP_CHAT_ENGINE_KEY } }\n                    )\n                    .then(() => setLoading(false))\n                    .catch((error) => console.log(error))\n                });\n        })\n    }, [user, history]);\n\n    if(!user || loading ) return 'Loading...'; \n    return (\n        <div className='chats-page'>\n            <div className='nav-bar'>\n                <div className='logo-tab'>\n                    <h1>ChatterBox</h1>\n                </div>\n                <div onClick={handleLogout}className='logout-tab'>\n                    Logout\n                </div>\n            </div>\n            <div className='chatEngine'>\n                <ChatEngine \n                    height=\"calc(100vh - 66px)\"\n                    projectID= { process.env.REACT_APP_CHAT_ENGINE_ID }\n                    userName= { user.email }\n                    userSecret= { user.uid }\n                />\n            </div>\n        </div>\n    );\n}\n\nexport default Chats;"],"mappings":"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"},"metadata":{},"sourceType":"module"}